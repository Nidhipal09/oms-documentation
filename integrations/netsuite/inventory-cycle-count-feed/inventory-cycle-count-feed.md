## Requirement

Prepare the Inventory Cycle Count Variance Feed CSV file format for NetSuite.

#### Sample Values

The Inventory Cycle Count Variance Feed should have the following details, which will be further consumed by the external system NetSuite:

| Reference No | Adjustment Account | Item | Adjust Qty By | Location | Date | Memo | Subsidiary | HC Inventory Adj |
|--------------|--------------------|------|---------------|----------|------|------|------------|------------------|
| 10010 | 927 | 42-04S | 5 | 254 | 05/23/2023 | Inventory cycle count by HotWax | 1 | 10010 |
| 10010 | 927 | 30-01S | \-5 | 254 | 05/23/2023 | Inventory cycle count by HotWax | 1 | 10010 |

# NiFi

The flow is currently being used in the below Instance.

| UAT | Prod |
|-----|------|
| https://nifi-uat.hotwax.io | [https://napita.hotwax.io](https://napita.hotwax.io/nifi/login) |

### Variables

1. **Project Level Processor group variables**

   | Variable Name | Description | UAT Value | Production Value |
   |---------------|-------------|-----------|------------------|
   | source.sftp.username | The user name is used for the source sftp user name. | krewe-uat-sftp | After the production setup carefully will add the sftp details here. |
   | source.sftp.port | The port is used for the source sftp port. | 235 |  |
   | source.sftp.password | The password is used for the source sftp password. | Ht5#nkreweuat |  |
   | source.sftp.host | The host is used for the source sftp host. | sftp.hotwax.io |  |
   | feed.fileName.dateTimeFormat | The date and time format is used for the file name. | yyyy-MM-dd-HH_mm_ss_SSS\*\*EX-\*\*Krewe_InventoryCycleCountVarianceFeed |  |
   | destination.sftp.username | The user name is used for the destination sftp user name. | krewe-uat-sftp |  |
   | destination.sftp.port | The port is used for the destination sftp port. | 235 |  |
   | destination.sftp.password | The password is used for the destination sftp password. | Ht5#nkreweuat |  |
   | destination.sftp.host | The host is used for the destination sftp host. | sftp.hotwax.io |  |
   | destination.logs.sftp.username | The user name is used for the destination log sftp user name. | smuat-sftp |  |
   | destination.logs.sftp.port | The port is used for the destination log sftp port. | 235 |  |
   | destination.logs.sftp.password | The password is used for the destination log sftp password. | Ht5@nsmuat |  |
   | destination.logs.sftp.host | The host is used for the destination log sftp host. | sftp.hotwax.io |  |
   | default.timeZone | Time zone according to the brand specific | America/New_York |  |

2. **Inventory Cycle Count Variance Feed HotWax to NetSuite Process Group level Variables**

   <table>
   <tr>
   <th>

   <div>Variable Name</div></th>
   <th>

   <div>Description</div></th>
   <th>

   <div>UAT Value</div></th>
   <th>

   <div>Production Value</div></th>
   </tr>
   <tr>
   <td>

   <span dir="">hotwax.</span>inventory<span dir="">.cyclecount.variance.feed.sftp.path</span>
   </td>
   <td>

   <div>

   <span dir="">The SFTP path from which NiFi will read the JSON feed file generated by HC</span>

   </div></td>
   <td>

   <div>/home/krewe-uat-sftp/hotwax/InventoryCycleCountVariance</div></td>
   <td>

   </td>
   </tr>
   <tr>
   <td>

   <div>

   <span dir="">hotwax.</span>inventory<span dir="">.cyclecount.variance.feed.sftp.path.archive</span>

   </div></td>
   <td>

   <div>

   The <span dir="">SFTP path to move the file after successfully fetching its content</span>

   </div></td>
   <td>

   <div>/home/krewe-uat-sftp/hotwax/InventoryCycleCountVariance/archive</div></td>
   <td>

   <div>

   </div></td>
   </tr>
   <tr>
   <td>

   <div>

   <span dir="">destination.</span>inventory<span dir="">.cyclecount.variance.sftp.path</span>

   </div></td>
   <td>

   <div>After transformation, a prepared JSON format file will be kept in this location.</div></td>
   <td>

   <div>/home/krewe-uat-sftp/netsuite/inventorycyclecount/variance</div></td>
   <td>

   <div>

   </div></td>
   </tr>
   <tr>
   <td>

   <div>

   <span dir="">destination.log.</span>inventory<span dir="">.cyclecount.variance.sftp.path</span>

   </div></td>
   <td>

   <div>For backup, the final JSON format will be kept in this location</div></td>
   <td>

   <div>/home/krewe-uat-sftp/nifi-feed-logs/netsuite/inventorycyclecount/variance</div></td>
   <td>

   <div>

   </div></td>
   </tr>
   <tr>
   <td>

   <div>

   <span dir="">feed.fileName.withPrefix</span>

   </div></td>
   <td>

   <div>The prefix used to prepare the name of the final JSON file which will be sent to an external system</div></td>
   <td>

   <div>

   </div>
   <div>

Krewe_InventoryCycleCountVarianceFeed
   </div></td>
   <td>

   </td>
   </tr>
   </table>

   ### Transformation of Inventory Cycle Count Variance Feed
   1. Jolt Spec to transform the HC generated Inventory Cycle Count Variance Feed for NetSuite
      1. https://git.hotwax.co/HC2/plugins/nifi-transform/-/blob/develop/transform/HotWaxtoNetSuite/InventoryCycleCountsVariance/InventoryCycleCountsFeedVarianceSpec.json

### Properties
| NetSuite Field        | Type   | Description                                                       | Mapping from HC Entity                         |
|-----------------------|--------|-------------------------------------------------------------------|------------------------------------------------|
| Reference No.         | string | The reference number assigned to an inventory count import in the system. | InventoryCountImport.inventoryCountImportId |
| Adjustment Account    | string | The account for the inventory adjustment in the system.          | 1. The value for this field is prepared using the variable **default.adjustmentAccount** in NiFi. <br/> 2. Sample UAT value - 927 |
| Item                  | string | The name of the Product in the system.                            | Product.internalName <br/> Product.productName <br/> **NOTE:** Product using ProductAssoc to get the parent product |
| Adjust Qty By         | Number | The quantity of items to adjust the inventory in the system.     | InvCountImportVariance.varianceQuantityOnHand |
| Location              | string | The store or warehouse location where the inventory count import is being recorded within the system. | Facility.externalId   |
| Date                  | string | The date when inventory count import created in the system.      | InventoryCountImport.createdDate |
| Memo                  | string | The memo field is used to keep a log regarding the inventory count imported in the system. | 1. The value for this field is prepared using the variable **default.subsidiary** in NiFi. <br/> 2. Sample UAT value - 1 |
| Subsidiary            | string | The subsidiary associated with the inventory count import in the system. | 1. The value for this field is prepared using the variable **default.subsidiary** in NiFi. <br/> 2. Sample UAT value - Inventory cycle count by HotWax |
| HC Inventory Adj Id   | string | The Inventory Adjustment ID of HC.                                | InventoryCountImport.inventoryCountImportId |